<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no, email=no" />
    <title>简途旅行</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="/images/logo.ico" rel="icon" type="image/x-icon"/>
    <link rel="stylesheet" href="./css/recruitment.scss??__inline"/>
</head>
<body>
<div class="price-cover"></div>
<div class="price-modal">
    <div class="title">哇,恭喜你抽到</div>
    <div class="priceContent">一坨大便</div>
    <img src="/images/thailand/getPrice.png" alt="">
    <p>稍后我们的工作人员会通过电话联系您,</p>
    <p>请注意保持手机畅通哦!</p>
    <button>确定</button>
</div>
<div class="no-price-modal">
    <div class="title">抱歉!没有抽到哦!</div>
    <img src="/images/thailand/noPrice.png" alt="">
    <p>稍后我们的工作人员会通过电话联系您,</p>
    <p>请注意保持手机畅通哦!</p>
    <button>确定</button>
</div>
<div class="player">
    <div class="banner">
        <img src="./images/banner@2x.png" alt="">
    </div>
    <div class="introduction">
        <p>7月7日简途·泰BUS首发！最精彩的线路，只等你最酷炫的玩法。成为『泰会玩』公路玩家，免费乘简途·泰BUS玩转泰国，告诉所有人：去泰国，就要像我这么玩！</p>
    </div>
    <div class="welfare">
        <img src="./images/01@2x.png" alt="">
    </div>
    <div class="require">
        <img src="./images/02@2x.png" alt="">
    </div>
    <div class="destination">
        <div class="title">
            <img src="./images/des-title@2x.png" alt="">
        </div>
        <div class="product mangu">
            <img src="./images/btn-mangu@2x.png" alt="">
        </div>
        <div class="product dacheng">
            <img src="./images/btn-dacheng@2x.png" alt="">
        </div>
        <div class="product batiya">
            <img src="./images/btn-batiya@2x.png" alt="">
        </div>
    </div>
    <div class="enlist">
        <img src="./images/enlist-btn@2x.png" alt="">
    </div>
    <div class="lazyload">
        <img src="./images/dacheng.png" alt="">
        <img src="./images/mangu.png" alt="">
        <img src="./images/batiya.png" alt="">
    </div>
</div>
<div class="lottery">
    <div class="title">
        <img src="images/lottery-title.png" alt="">
    </div>
    <div class="wheel">
        <img class="wheel-img" src="./images/wheel2@2x.png" alt="">
        <img class="pointer-img" src="./images/pointer.png" alt="">
    </div>
    <div class="input-gp">
        <input type="number" name="mobile" pattern="\d*" placeholder="请输入手机号码" value="">
        <label id="clickme" for="">
            <img src="./images/clickme@2x.png" alt="">
        </label>
    </div>
    <div class="rules">
        <div class="rules-title">
            <img src="./images/rule-title@2x.png" alt="">
        </div>
        <div class="rules-content">
            <ol>
                <li>抽奖日期：即日起-2016/7/20，名额有限，先领先得。</li>
                <li>奖品使用日期：2016/7/7-2016/9/30</li>
                <li>输入手机号，点击抽奖即可立即参与抽奖。</li>
                <li>一个手机号只能领取一次奖品。</li>
                <li>奖品随机发放。</li>
                <li>此活动所有解释权归简途所有。</li>
            </ol>
        </div>
    </div>
</div>
<script type="text/javascript" src="/common/js/zepto.min.js"></script>
<script type="text/javascript" src="/common/js/alert.js"></script>
<script type="text/javascript">
    (function (doc, win) {
        var docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    var clientWidth = docEl.clientWidth;
                    if (!clientWidth) return;
                    var style;
                    if (style = document.getElementById("forhtml")) {
                        style.parentNode.removeChild(style);
                    }
                    style = document.createElement("style");
                    style.id = "forhtml";
                    document.head.appendChild(style);
                    style.appendChild(document.createTextNode("html{font-size:" + 20 * (clientWidth / 320) + "px !important;}"));
                    docEl.style.fontSize = 20 * (clientWidth / 320) + 'px';
                };
        recalc();
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
    $(document).ready(function() {
        var startObj = {x: 0, y: 0};
        var endObj = {x: 0, y: 0};
        var rotateDeg = 0;
        var HEIGHT = 75;
        var $player = $('.player');
        document.addEventListener('touchstart', function (event) {
            startObj.x = event.touches[0].pageX;
            startObj.y = event.touches[0].pageY;
            endObj.x = 0;
            endObj.y = 0;
        })
        document.addEventListener('touchmove', function (event) {
            endObj.x = event.touches[0].pageX - startObj.x;
            endObj.y = event.touches[0].pageY - startObj.y;
        })

        $('.mangu').tap(function(e) {
            e.preventDefault();
            var $this = $(this);
            if (Math.abs(endObj.x) < 2 && Math.abs(endObj.y) < 2) {
                if(!$this.hasClass('expand')) {
                    HEIGHT += 31.675;
                    $this.addClass('expand').find('img').attr('src','./images/mangu.png');
                } else {
                    HEIGHT = HEIGHT - 31.675;
                    $this.removeClass('expand').find('img').attr('src','./images/btn-mangu@2x.png');
                    window.scrollTo(0,$('.destination').offset().top);
                }
                $player.css('height',HEIGHT + 'rem');
            }
        });
        $('.batiya').tap(function(e) {
            e.preventDefault();
            var $this = $(this);
            if (Math.abs(endObj.x) < 2 && Math.abs(endObj.y) < 2) {
                if(!$this.hasClass('expand')) {
                    HEIGHT += 28.3;
                    $this.addClass('expand').find('img').attr('src','./images/batiya.png');
                } else {
                    HEIGHT = HEIGHT - 28.3;
                    $this.removeClass('expand').find('img').attr('src','./images/btn-batiya@2x.png');
                    window.scrollTo(0,$('.destination').offset().top);
                }
                $player.css('height',HEIGHT + 'rem');
            }
        });
        $('.dacheng').tap(function(e) {
            e.preventDefault();
            var $this = $(this);
            if (Math.abs(endObj.x) < 2 && Math.abs(endObj.y) < 2) {
                if(!$this.hasClass('expand')) {
                    HEIGHT += 13.5;
                    $this.addClass('expand').find('img').attr('src','./images/dacheng.png');
                } else {
                    HEIGHT = HEIGHT - 13.5;
                    $this.removeClass('expand').find('img').attr('src','./images/btn-dacheng@2x.png');
                    window.scrollTo(0,$('.destination').offset().top);
                }
                $player.css('height',HEIGHT + 'rem');
            }
        });


        $('#clickme').click(function(e) {
            e.preventDefault();
            var $this = $(this);

            var mobile = $.trim($('input[name=mobile]').val());
            if(!mobile) {
                $.alert({
                    msg: '请输入您的手机号码'
                });
            } else if(!/^0?(13|14|15|17|18)[0-9]{9}$/.test(mobile)) {
                $.alert({
                    msg : '请输入正确的手机号码'
                });
            } else {
                // 转盘
                $this.addClass('loading');
                $this.find('img').attr('src','./images/loading@2x.png');
                $.ajax({
                    url: '/mobile/gateway/wechat/activity/thailand/lottery',
                    type: 'post',
                    dataType: 'json',
                    data:{mobile:mobile},
                    success: function(data) {
                        if(data.code == 0) {
                            if(data.data == 'mobileCard') {
                                rotateDeg += (0 - rotateDeg % 360) + 1080;
                                setTimeout(function() {
                                    $this.removeClass('disabled');
                                    $('.price-cover').show();
                                    $('.price-modal .priceContent').text('泰国当地电话卡');
                                    $('.price-modal').show('');
                                },4500);
                            } else if(data.data == 'airportPickup') {
                                rotateDeg += (72 - rotateDeg % 360) + 1080;
                                setTimeout(function() {
                                    $this.removeClass('disabled');
                                    $('.price-cover').show();
                                    $('.price-modal .priceContent').text('素万那普/廊曼机场单程接机');
                                    $('.price-modal').show();
                                },4500);
                            } else if(data.data == 'tourism') {
                                rotateDeg += (216 - rotateDeg % 360) + 1080;
                                setTimeout(function() {
                                    $this.removeClass('disabled');
                                    $('.price-cover').show();
                                    $('.price-modal .priceContent').text('泰BUS paragon-大皇宫往返车位');
                                    $('.price-modal').show();
                                },4500);
                            } else if(data.data == 'coupon') {
                                rotateDeg += (288 - rotateDeg % 360) + 1080;
                                setTimeout(function() {
                                    $this.removeClass('disabled');
                                    $('.price-cover').show();
                                    $('.price-modal .priceContent').text('泰BUS10元优惠券');
                                    $('.price-modal').show();
                                },4500);
                            } else {
                                rotateDeg += (144 - rotateDeg % 360) + 1080;
                                setTimeout(function() {
                                    $this.removeClass('disabled');
                                    $('.price-cover').show();
                                    $('.price-modal .priceContent').text('泰BUS20元优惠券');
                                    $('.price-modal').show();
                                },4500);
                            }
                            $this.addClass('disabled');
                            window.scrollTo(0,0);
                            $('.wheel-img').css({
                                '-webkit-transition': '4s ease-in-out',
                                'transition': '4s ease-in-out',
                                '-webkit-transform':'rotate('+rotateDeg+'deg)',
                                'transform':'rotate('+rotateDeg+'deg)'
                            });
                        } else {
                            $.alert({
                                msg : data.reason
                            });
                        }
                        $this.removeClass('loading');
                        $this.find('img').attr('src','./images/clickme@2x.png');
                    },
                    error: function() {
                        $.alert({
                            msg : '网络异常，请重试！'
                        });
                        $this.removeClass('loading');
                        $this.find('span').text('点我抽奖');
                    }
                });
            }
        });
        // 关闭modal
        $('.price-modal button').click(function(e) {
            e.preventDefault();
            $('.price-cover').hide();
            $('.price-modal').hide();
        });
        $('.no-price-modal button').click(function(e) {
            e.preventDefault();
            $('.price-cover').hide();
            $('.no-price-modal').hide();
        });
        $('.enlist').click(function() {
            // 点击报名操作
        });
    })
</script>
</body>
</html>
